<!-- Header -->
<div class="mb-4 p-4 md:flex md:items-center md:justify-between md:max-w-6xl md:m-auto md:text-right">
  <div>
    <div class="flex items-center mb-2">
      <div class="mr-1">
        <p class="font-roboto font-bold text-xs text-black">
          All states
        </p>
      </div>
      <div>
        <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
          <path d="M3.26651 1.26308C2.91116 1.61235 2.91116 2.17655 3.26651 2.52581L6.80182 6.00056L3.26651 9.47532C2.91116 9.82458 2.91116 10.3888 3.26651 10.738C3.62187 11.0873 4.1959 11.0873 4.55125 10.738L8.73349 6.62745C9.08884 6.27819 9.08884 5.71399 8.73349 5.36472L4.55125 1.25412C4.20501 0.913814 3.62187 0.913814 3.26651 1.26308Z" fill="black" fill-opacity="0.18"/>
        </svg>
      </div>
      <div class="ml-1">
        <p class="font-roboto font-bold text-xs text-blue-200">
          North Stateland
        </p>
      </div>
    </div>
    <h1 class="mb-2 font-roboto font-bold text-4xl text-black">
      North Stateland
    </h1>
    <div class="flex items-center mb-4">
      <div class="mr-1">
        <p class="font-roboto font-bold text-lg text-black">
          Report for OCT-2019
        </p>
      </div>
      <div>
        <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
          <path d="M2.33031 5.23408L5.21591 8.61786C5.65042 9.12738 6.35232 9.12738 6.78684 8.61786L9.67243 5.23408C10.3743 4.411 9.87298 3 8.8814 3H3.11021C2.11863 3 1.62841 4.411 2.33031 5.23408Z" fill="black" fill-opacity="0.54"/>
        </svg>
      </div>
    </div>
  </div>
  <div>
    <div class="flex items-center mb-4 md:flex-col md:items-end md:justify-end md:mb-2">
      <div class="mr-4 md:mr-0 md:mb-2">
        <p class="font-roboto font-bold text-base text-blue-200 uppercase tracking-wider">
          Print
        </p>
      </div>
      <div>
        <p class="font-roboto font-bold text-base text-blue-200 uppercase tracking-wider">
          Download
        </p>
      </div>
    </div>
    <p class="font-roboto font-normal text-base text-grey-400">
      Last updated 12-NOV-2019
    </p>
  </div>
</div>
<!-- Cards -->
<div class="p-4 md:flex md:flex-wrap md:max-w-6xl md:m-auto">
  <!-- Controlled patients trend -->
  <div class="md:w-1/2 md:pr-2">
    <div class="mb-4 p-4 rounded-md bg-white shadow-md md:flex md:flex-col md:justify-between md:h-96">
      <div>
        <div class="mb-4">
          <p class="mb-1 font-roboto font-bold text-lg text-black">
            Controlled patients trend
          </p>
          <p class="font-roboto font-normal text-sm text-grey-400">
            Registered patients with BP &lt;140/90 at their most recent visit in the past 90 days.
          </p>
        </div>
        <div>
          <p class="font-roboto font-bold text-4xl text-green-200">
            14,200
          </p>
          <p class="font-roboto font-normal text-sm text-grey-400">
            <span class="font-bold">0.3%</span> of estimated 4,200,000 hypertensive population
          </p>
        </div>
      </div>
      <div>
        <div class="md:relative md:h-32">
          <canvas id="controlledPatientsTrend"></canvas>
        </div>
        <div class="flex justify-between mt-2">
          <div>
            <p class="font-roboto font-bold text-sm text-black">
              Start
            </p>
            <p class="font-roboto font-normal text-sm text-black">
              Jan 2017
            </p>
          </div>
          <div class="text-right">
            <p class="font-roboto font-bold text-sm text-black">
              Current
            </p>
            <p class="font-roboto font-normal text-sm text-black">
              Apr 2020
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Control rate of all registered HTN patients -->
  <div class="md:w-1/2 md:pl-2">
    <div class="mb-4 p-4 rounded-md bg-white shadow-md md:flex md:flex-col md:justify-between md:h-96">
      <div class="mb-4">
        <p class="mb-1 font-roboto font-bold text-lg text-black">
          Control rate of all registered HTN patients
        </p>
        <p class="font-roboto font-normal text-sm text-grey-400">
          Proportion of registered patients with BP &gt;140/90 at their most recent visit in the past 90 days
        </p>
      </div>
      <div class="mt-8 md:flex-grow md:flex md:items-center md:justify-between md:mt-0">
        <div class="mb-6 text-center md:flex-grow md:mb-0">
          <p class="font-roboto font-bold leading-tight text-6xl text-green-200 md:h-20 md:mb-4">
            48.9%
          </p>
          <p class="font-roboto font-bold text-xl text-black md:text-base">
            14,200 of 28,400 patients
          </p>
        </div>
        <div class="md:flex md:flex-col md:items-center md:flex-grow">
          <div class="relative h-40 md:h-20 md:w-2/3 md:mb-4">
            <canvas id="controlRateOfAllRegisteredPatients"></canvas>
          </div>
          <p class="font-roboto font-bold text-sm text-black md:text-base md:font-medium md:text-grey-400">
            Last 12 months
          </p>
        </div>
      </div>
    </div>
  </div>
  <!-- Cumulative registration -->
  <div class="md:w-1/2 md:pr-2">
    <div class="mb-4 p-4 rounded-md bg-white shadow-md md:flex md:flex-col md:justify-between md:h-96">
      <div>
        <div class="mb-4">
          <p class="mb-1 font-roboto font-bold text-lg text-black">
            Cumulative registration
          </p>
          <p class="font-roboto font-normal text-sm text-grey-400">
            Total number of patient registrations in all state facilities
          </p>
        </div>
        <div>
          <p class="font-roboto font-bold text-4xl text-purple-200">
            28,400
          </p>
          <p class="font-roboto font-normal text-sm text-grey-400">
            <span class="font-bold">0.6%</span> of estimated 4,200,000 hypertensive population
          </p>
        </div>
      </div>
      <div>
        <div class="md:relative md:h-32">
          <canvas id="cumulativeRegistrations"></canvas>
        </div>
        <div class="flex justify-between mt-2">
          <div>
            <p class="font-roboto font-bold text-sm text-black">
              Start
            </p>
            <p class="font-roboto font-normal text-sm text-black">
              Jan 2017
            </p>
          </div>
          <div class="text-right">
            <p class="font-roboto font-bold text-sm text-black">
              Current
            </p>
            <p class="font-roboto font-normal text-sm text-black">
              May 2020
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Quarterly cohort trend -->
  <div class="md:w-1/2 md:pl-2">
    <div class="p-4 rounded-md bg-white shadow-md md:flex md:flex-col md:justify-between md:h-96">
      <div class="mb-6">
        <div class="mb-2">
          <p class="mb-1 font-roboto font-bold text-lg text-black">
            Quarterly cohort trend
          </p>
          <p class="font-roboto font-normal text-sm text-grey-400">
            The result for patients registered in a quarter at their follow-up visit in the following quarter
          </p>
        </div>
        <div class="flex">
          <div class="flex items-center mr-6">
            <div class="h-2 w-2 mr-2 rounded-full bg-green-200"></div>
            <p class="font-roboto font-bold text-xs text-green-200">
              Visited and BP &lt;140/90
            </p>
          </div>
          <div class="flex items-center mr-6">
            <div class="h-2 w-2 mr-2 rounded-full bg-yellow-300"></div>
            <p class="font-roboto font-bold text-xs text-yellow-300">
              Visited and BP &ge;140/90
            </p>
          </div>
          <div class="flex items-center">
            <div class="h-2 w-2 mr-2 rounded-full bg-red-200"></div>
            <p class="font-roboto font-bold text-xs text-red-200">
              No BP measure
            </p>
          </div>
        </div>
      </div>
      <div class="md:flex md:flex-wrap">
        <div class="mb-4 md:w-1/2 md:pr-2">
          <div>
            <p class="font-roboto font-bold text-sm text-black">
              Results in Q3-2019
            </p>
            <p class="font-roboto font-medium text-sm text-black">
              Patients registered Q2-2019
            </p>
          </div>
          <div class="relative h-12">
            <canvas id="quarterlyCohortResults1"></canvas>
          </div>
        </div>
        <div class="mb-4 md:w-1/2 md:pl-2">
          <div>
            <p class="font-roboto font-bold text-sm text-black">
              Results in Q2-2019
            </p>
            <p class="font-roboto font-medium text-sm text-black">
              Patients registered Q1-2019
            </p>
          </div>
          <div class="relative h-12">
            <canvas id="quarterlyCohortResults2"></canvas>
          </div>
        </div>
        <div class="mb-4 md:w-1/2 md:pr-2 md:mb-0">
          <div>
            <p class="font-roboto font-bold text-sm text-black">
              Results in Q1-2019
            </p>
            <p class="font-roboto font-medium text-sm text-black">
              Patients registered Q4-2018
            </p>
          </div>
          <div class="relative h-12">
            <canvas id="quarterlyCohortResults3"></canvas>
          </div>
        </div>
        <div class="md:w-1/2 md:pl-2">
          <div>
            <p class="font-roboto font-bold text-sm text-black">
              Results in Q4-2018
            </p>
            <p class="font-roboto font-medium text-sm text-black">
              Patients registered Q3-2018
            </p>
          </div>
          <div class="relative h-12">
            <canvas id="quarterlyCohortResults4"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  // Controlled patients trend
  var controlledPatientsTrendCanvas =
    document.getElementById("controlledPatientsTrend").getContext("2d");
  var greenGradientFill =
    controlledPatientsTrendCanvas.createLinearGradient(0, 400, 0, -300);
  greenGradientFill.addColorStop(0, "rgba(81, 205, 130, 0)");
  greenGradientFill.addColorStop(1, "rgba(81, 205, 130, 0.2)");
  var controlled_patients = JSON.parse('<%= raw(@controlled_patients.to_json) %>');
  console.log(controlled_patients);
  const trendData = [
    3409,
    3712,
    3901,
    4001,
    4051,
    4200,
    7004,
    7120,
    7707,
    8020,
    8102,
    8600,
    9000,
    9500,
    9967,
    9999,
    10001,
    10451,
    10781,
    10800,
    10801,
    10802,
    11501,
    11550,
    11599,
    11700,
    11800,
    11900,
    11900,
    11999,
    11999,
    12000,
    12001,
    12002,
    12100,
    14200,
  ];
  const trendLabels = [
    "May 2017",
    "Jun 2017",
    "Jul 2017",
    "Aug 2017",
    "Sep 2017",
    "Oct 2017",
    "Nov 2017",
    "Dec 2017",
    "Jan 2018",
    "Feb 2018",
    "Mar 2018",
    "Apr 2018",
    "May 2018",
    "Jun 2018",
    "Jul 2018",
    "Aug 2018",
    "Sep 2018",
    "Oct 2018",
    "Nov 2018",
    "Dec 2018",
    "Jan 2019",
    "Feb 2019",
    "Mar 2019",
    "Apr 2019",
    "May 2019",
    "Jun 2019",
    "Jul 2019",
    "Aug 2019",
    "Sep 2019",
    "Oct 2019",
    "Nov 2019",
    "Dec 2019",
    "Jan 2020",
    "Feb 2020",
    "Mar 2020",
    "Apr 2020",
  ];
  var controlledPatientsTrendChart = new Chart(
    controlledPatientsTrendCanvas,
    {
      type: "line",
      data: {
        labels: trendLabels,
        lineTension: 0,
        datasets: [{
          backgroundColor: greenGradientFill,
          borderColor: "rgba(81, 205, 130, 1)",
          pointStyle: "dash",
          data: trendData,
        }],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        elements: {
          line: {
            tension: 0,
          },
        },
        legend: {
          display: false,
        },
        scales: {
          xAxes: [{
            display: false,
            gridLines: {
              display: false,
              drawBorder: false,
            },
          }],
          yAxes: [{
            display: false,
            gridLines: {
              display: false,
              drawBorder: false,
            },
          }],
        },
        tooltips: {
          titleFontFamily: "Roboto",
          bodyFontFamily: "Roboto",
          backgroundColor: "rgb(0, 0, 0)",
          titleFontSize: 16,
          bodyFontSize: 14,
          displayColors: false,
          yPadding: 12,
          xPadding: 12,
          callbacks: {
            label: function(tooltipItem, data) {
              var value = tooltipItem.value.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
              value += " controlled patients";
              return value;
            },
          },
        }
      }
    }
  );
  // Cumulative registrations
  var cumulativeRegistrationsCanvas =
    document.getElementById("cumulativeRegistrations").getContext("2d");
  var purpleGradientFill =
    cumulativeRegistrationsCanvas.createLinearGradient(0, 400, 0, -300);
    purpleGradientFill.addColorStop(0, "rgba(157, 74, 199, 0)");
    purpleGradientFill.addColorStop(1, "rgba(157, 74, 199, 0.2)");
  var cumulativeRegistrationsChart = new Chart(
    cumulativeRegistrationsCanvas,
    {
      type: "line",
      data: {
        labels: trendLabels,
        lineTension: 0,
        datasets: [{
          backgroundColor: purpleGradientFill,
          borderColor: "rgba(157, 74, 199, 1)",
          pointStyle: "dash",
          data: trendData.map(point => point * 2),
        }],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        elements: {
          line: {
            tension: 0,
          },
        },
        legend: {
          display: false,
        },
        scales: {
          xAxes: [{
            display: false,
            gridLines: {
              display: false,
              drawBorder: false,
            },
          }],
          yAxes: [{
            display: false,
            gridLines: {
              display: false,
              drawBorder: false,
            },
          }],
        },
        tooltips: {
          titleFontFamily: "Roboto",
          bodyFontFamily: "Roboto",
          backgroundColor: "rgb(0, 0, 0)",
          titleFontSize: 16,
          bodyFontSize: 14,
          displayColors: false,
          yPadding: 12,
          xPadding: 12,
          callbacks: {
            label: function(tooltipItem, data) {
              var value = tooltipItem.value.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
              value += " registered patients";
              return value;
            },
          },
        }
      }
    }
  );
  // Control rate of all registered HTN patients
  var controlRateOfAllRegisteredPatientsCanvas =
    document.getElementById("controlRateOfAllRegisteredPatients").getContext("2d");
  var controlRateOfAllRegisteredPatientsChart = new Chart(
    controlRateOfAllRegisteredPatientsCanvas,
    {
      type: "line",
      data: {
        labels: [
          "May 2019",
          "Jun 2019",
          "Jul 2019",
          "Aug 2019",
          "Sep 2019",
          "Oct 2019",
          "Nov 2019",
          "Dec 2019",
          "Jan 2020",
          "Feb 2020",
          "Mar 2020",
          "Apr 2020",
        ],
        lineTension: 0,
        datasets: [{
          backgroundColor: "#ffffff",
          borderColor: "rgba(81, 205, 130, 1)",
          pointStyle: "dash",
          data: [
            16.8,
            16.9,
            17.4,
            16.8,
            17.0,
            17.2,
            17.9,
            18.2,
            17.6,
            18.5,
            19.2,
            19.4,
          ],
        }],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        legend: {
          display: false,
        },
        scales: {
          xAxes: [{
            display: false,
            gridLines: {
              display: false,
              drawBorder: false,
            },
          }],
          yAxes: [{
            display: false,
            gridLines: {
              display: false,
              drawBorder: false,
            },
          }],
        },
        tooltips: {
          enabled: false,
        }
      }
    }
  );
  // Quarterly cohort trends
  const createCohortConfig = (p1, p2, p3) => {
    return {
      type: "horizontalBar",
      data: {
        labels: ["Results in Q3-2019"],
        datasets: [
          { backgroundColor: "#3db26c", data: [p1] },
          { backgroundColor: "#e0b000", data: [p2] },
          { backgroundColor: "#ff3355", data: [p3] },
        ]
      },
      options: {
        tooltips: {
          position: "nearest",
          bodyAlign: "left",
          callbacks: {
            label: function(tooltipItem, data) {
              return tooltipItem.value + "%";
            },
          },
        },
        responsive: true,
        maintainAspectRatio: false,
        legend: {
          display: false,
        },
        scales: {
          xAxes: [{
            display: false,
            stacked: true,
            gridLines: {
              display: false,
              drawBorder: false,
            },
          }],
          yAxes: [{
            stacked: true,
            display: false,
            gridLines: {
              display: false,
              drawBorder: false,
            },
          }],
        },
      },
    };
  };
  // Quarterly cohort trend 1
  var quarterlyCohortResults1Canvas =
    document.getElementById("quarterlyCohortResults1").getContext("2d");
  var quarterlyCohortResults1Chart = new Chart(quarterlyCohortResults1Canvas, createCohortConfig(37,31,32));
  // Quarterly cohort trend 2
  var quarterlyCohortResults2Canvas =
    document.getElementById("quarterlyCohortResults2").getContext("2d");
  var quarterlyCohortResults2Chart = new Chart(quarterlyCohortResults2Canvas, createCohortConfig(25,33,42));
  // Quarterly cohort trend 3
  var quarterlyCohortResults3Canvas =
    document.getElementById("quarterlyCohortResults3").getContext("2d");
  var quarterlyCohortResults3Chart = new Chart(quarterlyCohortResults3Canvas, createCohortConfig(24,52,24));
  // Quarterly cohort trend 4
  var quarterlyCohortResults4Canvas =
    document.getElementById("quarterlyCohortResults4").getContext("2d");
  var quarterlyCohortResults4Chart = new Chart(quarterlyCohortResults4Canvas, createCohortConfig(52,17,31));
</script>